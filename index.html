<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ö–≤—ñ–∑ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Onest:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />

    <style></style>
  </head>
  <body>
    <div class="wrap">
      <div class="frame">
        <div class="grid">
          <section class="left">
            <div class="quiz-progress">
              <div class="quiz-progress__fill" id="progressFill"></div>

              <div class="quiz-progress__text" id="stepLabel">
                –í–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î—Ç–µ –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è 1 –∑ 4
              </div>
            </div>

            <h1 id="questionTitle">
              <span class="line1">–î–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ</span>
              <span class="line2">–∑—Ä–æ–±–∏—Ç–∏ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è?</span>
            </h1>

            <div class="options" id="options"></div>

            <div class="nav">
              <button class="btn-back" id="btnBack" type="button">–ù–∞–∑–∞–¥</button>

              <button class="btn btn-next" id="btnNext" type="button">
                –î–∞–ª—ñ ‚Üí
              </button>
            </div>
          </section>

          <aside class="right" id="rightPanel">
            <!-- Default right card -->
            <div class="card" id="defaultCard">
              <div class="intro">
                <div class="hero">
                  <div class="person">
                    <img src="men.png" alt="–ú–µ–Ω–µ–¥–∂–µ—Ä" />

                    <div class="label label--name">
                      <span>–ú–∞–∫—Å–∏–º</span>
                    </div>

                    <div class="label label--role">
                      <span>–ú–µ–Ω–µ–¥–∂–µ—Ä ‚Äú–ü–∞—Ä—Ç–Ω–µ—Ä –ö–ª—ñ–Ω‚Äù</span>
                    </div>
                  </div>
                </div>

                <div class="pitch">
                  <div class="pitch__inner">
                    –î–∞–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è,
                    <small>—â–æ–± –º–∏ –º–æ–≥–ª–∏ —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤–∞—Ä—Ç—ñ—Å—Ç—å</small>
                  </div>
                </div>
              </div>
              <div class="benefits">
                <div class="benefitsTitle">–í –∫—ñ–Ω—Ü—ñ —Ç–µ—Å—Ç–∞ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ:</div>

                <div class="benefitsRow">
                  <div class="benefit">
                    <div class="benefit__img">
                      <img src="b1.avif" alt="" />
                    </div>
                    <span>
                      –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ<br />
                      —Ç–∞ —Å—Ç—Ä–æ–∫—ñ–≤ —Ä–æ–±–æ—Ç–∏
                    </span>
                  </div>

                  <div class="benefit">
                    <div class="benefit__img">
                      <img src="b2.avif" height="74" alt="" />
                    </div>
                    <span>–ó–Ω–∏–∂–∫—É 10%<br />–Ω–∞ –ø–µ—Ä—à–µ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è</span>
                  </div>

                  <div class="benefit">
                    <div class="benefit-media benefit-media--gifts">
                      <img
                        src="b3.avif"
                        class="gift gift--logo"
                        alt=""
                      />
                      <img
                        src="b4.avif"
                        class="gift gift--aroma"
                        alt=""
                      />
                      <img
                        src="b5.avif"
                        class="gift gift--candle"
                        alt=""
                      />
                    </div>

                    <span>1 –∑ 3<br />–ø–æ–¥–∞—Ä—É–Ω–∫—ñ–≤ –Ω–∞ –≤–∏–±—ñ—Ä</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Final view (hidden until step 5) -->
            <div id="finalView" style="display: none">
              <h2 class="finalTitle">–í–∞—à —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –≥–æ—Ç–æ–≤–∏–π!</h2>
              <p class="finalSubtitle">–î–µ –≤–∞–º –∑—Ä—É—á–Ω—ñ—à–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç?</p>

              <div class="finalCard">
                <div class="channelRow" id="channelRow">
                  <div class="chip" data-channel="phone" data-on="true">
                    –¢–µ–ª–µ—Ñ–æ–Ω
                  </div>
                  <div class="chip" data-channel="whatsapp">WhatsApp</div>
                  <div class="chip" data-channel="telegram">Telegram</div>
                  <div class="chip" data-channel="viber">Viber</div>
                </div>

                <div class="phoneRow">
                  <div class="flag">üá∫üá¶ +380</div>
                  <input
                    class="input"
                    id="phoneInput"
                    inputmode="tel"
                    placeholder="(__) ___ __ __"
                  />
                </div>

                <label class="agree">
                  <input type="checkbox" id="agreeChk" />
                  <span>–Ø –ø–æ–≥–æ–¥–∂—É—é—Å—å –∑ –ø–æ–ª—ñ—Ç–∏–∫–æ—é –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</span>
                </label>

                <button class="finalBtn" id="submitBtn" type="button" disabled>
                  –û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ
                </button>
              </div>

              <div class="mini" id="miniSocialProof">
                –í–∂–µ 22 472 –ª—é–¥–∏–Ω–∏ —Å–∫–æ—Ä–∏—Å—Ç–∞–ª–æ—Å—å –ø–æ—Å–ª—É–≥–∞–º–∏
              </div>
            </div>
          </aside>
        </div>
      </div>
    </div>

    <script>
      // ========= Config (–≤–æ–ø—Ä–æ—Å—ã/–≤–∞—Ä–∏–∞–Ω—Ç—ã) =========
      const btnNext = document.getElementById("btnNext");

      const steps = [
        {
          key: "place",
          title: "–î–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ<br>–∑—Ä–æ–±–∏—Ç–∏ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è?",
          options: [
            { label: "–ö–≤–∞—Ä—Ç–∏—Ä–∞", value: "apartment" },
            { label: "–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –±—É–¥–∏–Ω–æ–∫", value: "house" },
            { label: "–û—Ñ—ñ—Å/–∫–æ–º–µ—Ä—Ü—ñ–π–Ω–µ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è", value: "office" },
            { label: "–î–≤—ñ—Ä/–ë—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–æ", value: "yard" },
            { label: "–Ü–Ω—à–µ", value: "other" },
          ],
        },
        {
          key: "service",
          title: "–Ø–∫–µ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞—Ä–∞–∑?",
          options: [
            { label: "–ì–µ–Ω–µ—Ä–∞–ª—å–Ω–µ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è", value: "general" },
            { label: "–ü—ñ—Å–ª—è —Ä–µ–º–æ–Ω—Ç—É", value: "after_renovation" },
            { label: "–•—ñ–º—á–∏—Å—Ç–∫–∞ –º–µ–±–ª—ñ–≤/–∫–∏–ª–∏–º—ñ–≤", value: "dry_cleaning" },
            { label: "–ú–∏—Ç—Ç—è –≤—ñ–∫–æ–Ω", value: "windows" },
            { label: "–Ü–Ω—à–µ", value: "other" },
          ],
        },
        {
          key: "area",
          title: "–Ø–∫–∞ –ø–ª–æ—â–∞ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è (–ø—Ä–∏–±–ª–∏–∑–Ω–æ)?",
          options: [
            { label: "–î–æ 40–º¬≤", value: "0-40" },
            { label: "40‚Äì80–º¬≤", value: "40-80" },
            { label: "80‚Äì150–º¬≤", value: "80-150" },
            { label: "–ë—ñ–ª—å—à–µ 150–º¬≤", value: "150+" },
            { label: "–ù–µ –∑–Ω–∞—é/–¥–æ–ø–æ–º–æ–∂—ñ—Ç—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏", value: "unknown" },
          ],
        },
        {
          key: "urgency",
          title: "–Ø–∫ —à–≤–∏–¥–∫–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è?",
          options: [
            { label: "–°—å–æ–≥–æ–¥–Ω—ñ", value: "today" },
            { label: "–ü—Ä–æ—Ç—è–≥–æ–º 1‚Äì2 –¥–Ω—ñ–≤", value: "1-2days" },
            { label: "–ù–∞ –≤–∏—Ö—ñ–¥–Ω–∏—Ö", value: "weekend" },
            { label: "–ü—Ä–æ—Ç—è–≥–æ–º —Ç–∏–∂–Ω—è", value: "week" },
            { label: "–ù–µ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ", value: "not_urgent" },
          ],
        },
      ];

      // ========= State =========
      const state = {
        stepIndex: 0,
        isTransitioning: false,
        answers: {
          place: null,
          service: null,
          area: null,
          urgency: null,
        },
        channel: "phone",
        phone: "",
        agreed: false,
      };

      // ========= DOM =========
      const questionTitle = document.getElementById("questionTitle");
      const optionsEl = document.getElementById("options");
      const btnBack = document.getElementById("btnBack");
      const progressBar = document.getElementById("progressBar");
      const stepLabel = document.getElementById("stepLabel");

      const defaultCard = document.getElementById("defaultCard");
      const finalView = document.getElementById("finalView");
      const channelRow = document.getElementById("channelRow");
      const phoneInput = document.getElementById("phoneInput");
      const agreeChk = document.getElementById("agreeChk");
      const submitBtn = document.getElementById("submitBtn");
      const toast = document.getElementById("toast");

      // ========= Helpers =========
      function showToast(text) {
        toast.textContent = text;
        toast.classList.add("on");
        setTimeout(() => toast.classList.remove("on"), 1600);
      }

      function setProgress() {
        const total = steps.length;
        const current = Math.min(state.stepIndex + 1, total);

        const fill = document.getElementById("progressFill");

        const MAX_FILL = 85;
        const percent = (current / total) * MAX_FILL;

        fill.style.width = `calc(${percent}% - 12px)`;

        stepLabel.textContent = `–í–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î—Ç–µ –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è ${current} –∑ ${total}`;
      }

      function renderStep() {
        // --- –∞–Ω–∏–º–∞—Ü–∏—è –≤—ã—Ö–æ–¥–∞ ---
        questionTitle.classList.add("fade-out");
        optionsEl.classList.add("fade-out");

        setTimeout(() => {
          // ====== –§–ò–ù–ê–õ ======
          if (state.stepIndex >= steps.length) {
            questionTitle.innerHTML = "";
            optionsEl.innerHTML = "";
            btnBack.style.visibility = "hidden";
            stepLabel.textContent = "";

            defaultCard.style.display = "none";
            finalView.style.display = "block";
            syncFinalControls();
            return;
          }

          // ====== –í–û–ü–†–û–° ======
          const s = steps[state.stepIndex];

          defaultCard.style.display = "flex";
          finalView.style.display = "none";
          // btnBack.style.visibility =
          //   state.stepIndex === 0 ? "hidden" : "visible";

          questionTitle.innerHTML = s.title;
          optionsEl.innerHTML = "";

          const selectedValue = state.answers[s.key];
          s.options.forEach((opt) => {
            const div = document.createElement("div");
            div.className = "opt";
            div.dataset.checked = String(opt.value === selectedValue);

            div.innerHTML = `
        <div class="radio"></div>
        <span>${opt.label}</span>
      `;

            div.addEventListener("click", () => {
              if (state.isTransitioning) return;

              state.isTransitioning = true;

              // 1Ô∏è‚É£ –°–Ω–∞—á–∞–ª–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤—ã–±–æ—Ä
              state.answers[s.key] = opt.value;
              div.dataset.checked = "true";

              // 2Ô∏è‚É£ –î–∞—ë–º –≥–ª–∞–∑—É —É–≤–∏–¥–µ—Ç—å –≥–∞–ª–æ—á–∫—É
              setTimeout(() => {
                // 3Ô∏è‚É£ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –¥–∞–ª—å—à–µ
                state.stepIndex++;
                state.isTransitioning = false;
                renderStep();
              }, 220); // üëà —Ç—É—Ç –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å—Å—è: 180‚Äì250
            });

            optionsEl.appendChild(div);
          });

          setProgress();

          // --- –∞–Ω–∏–º–∞—Ü–∏—è –≤—Ö–æ–¥–∞ ---
          questionTitle.classList.remove("fade-out");
          questionTitle.classList.add("fade-in");

          optionsEl.classList.remove("fade-out");
          optionsEl.classList.add("fade-in");
        }, 120);
      }

      function syncFinalControls() {
        // chips
        [...channelRow.querySelectorAll(".chip")].forEach((chip) => {
          chip.dataset.on = String(chip.dataset.channel === state.channel);
        });

        phoneInput.value = state.phone;
        agreeChk.checked = state.agreed;

        const phoneOk = normalizeUA(state.phone).length >= 12; // 380XXXXXXXXX (12 digits)
        submitBtn.disabled = !(phoneOk && state.agreed);
      }

      function normalizeUA(v) {
        return (v || "")
          .replace(/[^\d]/g, "")
          .replace(/^0+/, "") // —É–±—Ä–∞—Ç—å –≤–µ–¥—É—â–∏–µ –Ω—É–ª–∏ –µ—Å–ª–∏ —é–∑–µ—Ä –≤—Å—Ç–∞–≤–∏–ª
          .replace(/^3800/, "380") // —á—É—Ç—å-—á—É—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞
          .replace(/^38(?!0)/, "380"); // –µ—Å–ª–∏ –≤–≤–µ–ª–∏ 38..., –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ 380...
      }

      function formatPhoneInput(raw) {
        // –î–µ—Ä–∂–∏–º –ø—Ä–æ—Å—Ç—É—é –º–∞—Å–∫—É –≤–∏–¥–∞: (__) ___ __ __
        let digits = (raw || "").replace(/[^\d]/g, "");
        // –µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –≤—Å—Ç–∞–≤–∏–ª +380..., –≤—ã—Ç–∞—â–∏–º —Ö–≤–æ—Å—Ç
        digits = digits.replace(/^380/, "");
        // –º–∞–∫—Å–∏–º—É–º 9 —Ü–∏—Ñ—Ä (–±–µ–∑ 380)
        digits = digits.slice(0, 9);

        const p1 = digits.slice(0, 2);
        const p2 = digits.slice(2, 5);
        const p3 = digits.slice(5, 7);
        const p4 = digits.slice(7, 9);

        let out = "";
        out += "(" + p1;
        if (p1.length === 2) out += ")";
        if (p2.length) out += " " + p2;
        if (p3.length) out += " " + p3;
        if (p4.length) out += " " + p4;

        return out.trim();
      }

      // ========= Events =========
      btnBack.addEventListener("click", () => {
        if (state.stepIndex > 0) {
          state.stepIndex--;
          renderStep();
        }
      });

      channelRow.addEventListener("click", (e) => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        state.channel = chip.dataset.channel;
        syncFinalControls();
      });

      phoneInput.addEventListener("input", () => {
        phoneInput.value = formatPhoneInput(phoneInput.value);
        state.phone = phoneInput.value;
        syncFinalControls();
      });

      agreeChk.addEventListener("change", () => {
        state.agreed = agreeChk.checked;
        syncFinalControls();
      });

      submitBtn.addEventListener("click", async () => {
        // –°–±–æ—Ä payload
        const payload = {
          ...state.answers,
          channel: state.channel,
          phone: "380" + normalizeUA(state.phone).replace(/^380/, ""), // –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º 380...
          page_url: location.href,
          created_at: new Date().toISOString(),
        };

        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å UTM (–µ—Å–ª–∏ –Ω–∞–¥–æ)
        const params = new URLSearchParams(location.search);
        [
          "utm_source",
          "utm_medium",
          "utm_campaign",
          "utm_content",
          "utm_term",
        ].forEach((k) => {
          const v = params.get(k);
          if (v) payload[k] = v;
        });

        // ‚úÖ –¢—É—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—à—å —Å–≤–æ–π endpoint (Google Apps Script / CRM webhook)
        const ENDPOINT_URL = "https://example.com/webhook"; // <-- –ó–ê–ú–ï–ù–ò

        submitBtn.disabled = true;
        submitBtn.textContent = "–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ...";

        try {
          // –ó–∞–≥–ª—É—à–∫–∞: –µ—Å–ª–∏ endpoint –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
          // –£–¥–∞–ª–∏—à—å —ç—Ç–æ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏.
          localStorage.setItem("quiz_lead_last", JSON.stringify(payload));

          // –†–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞:
          // const res = await fetch(ENDPOINT_URL, {
          //   method: "POST",
          //   headers: { "Content-Type": "application/json" },
          //   body: JSON.stringify(payload),
          // });
          // if (!res.ok) throw new Error("Bad response");

          showToast("–ó–∞—è–≤–∫—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ");
          submitBtn.textContent = "–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ";
        } catch (err) {
          console.error(err);
          showToast("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ ‚ùå");
          submitBtn.disabled = false;
          submitBtn.textContent = "–û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ";
        }
      });

      // ========= Init =========
      renderStep();
    </script>
  </body>
</html>
